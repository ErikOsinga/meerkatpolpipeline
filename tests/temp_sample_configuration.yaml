version: 0.1

## required headers
# string matching target field name
targetfield: "A754"
# container with lofar software
lofar_container: /home/osingae/OneDrive/postdoc/software/containers/lofar_sksp.sif
# container with casa
casa_container: /home/osingae/OneDrive/postdoc/testing/eris22/stimela_casa_1.7.1.sif



## optional headers
# in case users have configured their own casa installation 'measurespath'.
# see https://casadocs.readthedocs.io/en/stable/notebooks/external-data.html
# make this point to the directory where the casa files are stored.
# casa_additional_bind: /net/rijn9/data2/osinga/meerkatBfields/software/casafiles


# some default parameters that are unlikely to change
defaults:

  # download measurement set, untar, clip channels
  download_preprocess:
    tries: inf
    waitretry_seconds: 2
    # check whether outside 163-3885 have been clipped 
    # or still 4096 chans. 
    # If the latter, clip
    # clip_chan_start: 163
    # clip_chan_end: 3885
    # clip_assumed_nchan: 4096
    clip_assumed_nchan: 64
    clip_chan_start: 0
    clip_chan_end: 63

  # e.g. caracal
  crosscal:
    prefix: caracalpipelinerun
    backend: singularity
    caracal_files: '/data2/osinga/meerkatBfields/caracal_files/'
    # auto determine calibrators ?
    auto_determine_obsconf: true
    caracal_template_strategy: /home/osingae/OneDrive/postdoc/projects/MEERKAT_similarity_Bfields/meerkatpolpipeline/templates/caracal-polcal-strategy-Lband.yml

################################################
# parameters that are likely to change per target
download_preprocess:
  enable: true
  link: https://archive-gw-1.kat.ac.za/1728976094-dataexport/1728976094_sdp_l0.ms.tar.gz?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJFUzI1NiJ9.eyJpc3MiOiJrYXQtYXJjaGl2ZS5rYXQuYWMuemEiLCJhdWQiOiJhcmNoaXZlLWd3LTEua2F0LmFjLnphIiwiaWF0IjoxNzI5Njg0NzUwLCJwcmVmaXgiOlsiMTcyODk3NjA5NCJdLCJleHAiOjE3MzQ4Njg3NTAsInN1YiI6ImVyaWsub3NpbmdhQHV0b3JvbnRvLmNhIiwic2NvcGVzIjpbInJlYWQiXX0.o6TGTtC3k3hInLqh0FU30ysLXA9z71oj068RXVN_pE5P22byDH95SmgP-bXCnb70Vmf1mS1nwVxClZbf9ix67A
  # will be saved in --working_dir / download /
  # output name is what to call the file thats downloaded 
  
  # symlink to trick pipeline into not preprocessing
  output_name: /home/osingae/OneDrive/postdoc/projects/MEERKAT_similarity_Bfields/small_test_ms/Abell754_parang_corrected-2023-03-25-3C286.ms
  # ms_name is what to call the (extracted) ms.

  # symlink to trick pipeline into not preprocessing
  ms_name: /home/osingae/OneDrive/postdoc/projects/MEERKAT_similarity_Bfields/small_test_ms/Abell754_parang_corrected-2023-03-25-3C286.ms
  # and then a small example ms at _preprocessed.ms grabbed from 3c286

  # if downloading the MS directly, output_name == ms_name is allowed
  
  # NOTE:
  # unless 'msdir' and 'dataid' are given in the caracal step below
  # then even if download step is disabled, ms_name will be used to determine the
  # location of the MS, so it can be used in caracal.

crosscal:
  enable: true
  # either caracal or casa
  which: caracal
  # OPTIONAL: location of ms, and where caracal will write, make sure its fairly empty for clarity.
  # msdir: /data2/osinga/meerkatBfields/Abell754/caracal_reduction/
  # OPTIONAL: name of ms,  ".ms" will be appended
  # dataid: "Abell754_default_uncalibrated-2023-03-25"
  # if those are not given, will create them as --workdir/ms_name from the download_preprocess step
  test: true
  # for testing with the small MS will need to give some bogus fieldnames
  # because the MS only contains one field, so auto_determine_obsconf doesnt work
  auto_determine_obsconf: false
  obsconf_target: target
  obsconf_gcal: gcal
  obsconf_xcal: xcal
  obsconf_bpcal: bpcal
  obsconf_fcal: fcal


check_calibrator:
  enable: false
  # crosscal_ms: will be determined automatically if not given
